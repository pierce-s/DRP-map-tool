<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Hagga Basin Map Tool</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<link rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      crossorigin=""/>

<style>
/* map fills the whole iframe */
html,body,#map{margin:0;height:100%;width:100%;background:#121212;color:#eee;font:14px/1.4 sans-serif;}
#map{position:relative;cursor:crosshair;}

.leaflet-control-zoom{top:10px;right:10px;left:auto!important;}

.coord-label{
  background:rgba(20,20,20,.85);border:none;color:#fff;font-family:monospace;
  padding:2px 4px;border-radius:3px;pointer-events:none;
}
.coord-label::before{display:none!important;}

/* overlay UI */
#arrows,#copy,#toast{position:absolute;z-index:401}
#arrows{bottom:10px;left:10px;display:grid;grid-template-areas:
        ". up ."
        "left . right"
        ". down .";grid-gap:4px;}
#arrows button,#copy{background:#1e1e1e;border:1px solid #444;color:#eee;
                     width:38px;height:38px;border-radius:4px;cursor:pointer;}
#arrows button[data-dir="up"]   {grid-area:up}
#arrows button[data-dir="down"] {grid-area:down}
#arrows button[data-dir="left"] {grid-area:left}
#arrows button[data-dir="right"]{grid-area:right}

#copy{bottom:10px;right:10px;padding:6px 12px;width:auto}
#copy.flash{background:#145f3c;border-color:#1c7d50;}

/* centred toast */
#toast{top:50%;left:50%;transform:translate(-50%,-50%);
       background:rgba(20,20,20,.9);color:#fff;font:14px monospace;
       padding:8px 14px;border-radius:6px;opacity:0;pointer-events:none;
       transition:opacity .2s linear;}
</style>
</head>
<body>

<div id="map">
  <div id="arrows">
    <button data-dir="up">↑</button>
    <button data-dir="left">←</button>
    <button data-dir="right">→</button>
    <button data-dir="down">↓</button>
  </div>
  <button id="copy" disabled>Copy Coordinates</button>
  <div id="toast">Copied</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script>
(function(){
  const imgPath='hagga-basin.png',
        copyBtn=document.getElementById('copy'),
        toast  =document.getElementById('toast'),
        arrows =document.getElementById('arrows');

  /* preload image to get native size */
  const im=new Image();
  im.src=imgPath;
  im.onload=()=>init(im.naturalWidth,im.naturalHeight);

  /* show / hide toast */
  function showToast(){
    toast.style.opacity='1';
    setTimeout(()=>toast.style.opacity='0',800);
  }

  /* fallback copy for sandboxed iframes (execCommand still works) */
  function fallbackCopy(text){
    const ta=document.createElement('textarea');
    ta.value=text;ta.style.position='fixed';ta.style.opacity='0';
    document.body.appendChild(ta);ta.select();document.execCommand('copy');
    document.body.removeChild(ta);
    showToast();
  }

  function init(w,h){

    /* ensure default pin images load */
    L.Icon.Default.mergeOptions({
      iconRetinaUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
      iconUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
      shadowUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png'
    });

    const bounds=[[0,0],[h,w]];
    const map=L.map('map',{
      crs:L.CRS.Simple,minZoom:-1,maxZoom:4,
      attributionControl:false,zoomControl:true,
      inertia:true,maxBounds:bounds,maxBoundsViscosity:1
    });
    L.imageOverlay(imgPath,bounds).addTo(map);
    map.fitBounds(bounds); map.setZoom(map.getZoom()+1);
    map.doubleClickZoom.disable();

    const clamp=(v,max)=>Math.max(0,Math.min(max,v));
    let marker=null,lastXY='';

    function update(latlng){
      const x=clamp(Math.round(latlng.lng),w),
            y=clamp(Math.round(latlng.lat),h);
      lastXY=`${x},${y}`;
      if(!marker.getTooltip())
        marker.bindTooltip(lastXY,{permanent:true,className:'coord-label',direction:'top'});
      else marker.setTooltipContent(lastXY);
      copyBtn.disabled=false;
    }

    map.on('click',e=>{
      const ll=[clamp(e.latlng.lat,h),clamp(e.latlng.lng,w)];
      if(!marker){
        marker=L.marker(ll,{draggable:true}).addTo(map)
               .on('drag',ev=>update(ev.latlng));
      }else marker.setLatLng(ll);
      update(marker.getLatLng());
    });

    /* arrow navigation */
    arrows.addEventListener('click',ev=>{
      const dir=ev.target.dataset.dir;if(!dir)return;
      const dx=dir==='left'?-100:dir==='right'?100:0,
            dy=dir==='up'?-100:dir==='down'?100:0;
      map.panBy([dx,dy],{duration:0.25});
      ev.stopPropagation();
    });
    L.DomEvent.disableClickPropagation(arrows);

    /* copy coordinates with fallback */
    copyBtn.addEventListener('click',ev=>{
      ev.stopPropagation();
      if(navigator.clipboard?.writeText){
        navigator.clipboard.writeText(lastXY).then(showToast,()=>fallbackCopy(lastXY));
      }else fallbackCopy(lastXY);
    });
  }
})();
</script>
</body>
</html>
